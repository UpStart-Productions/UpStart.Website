version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            # Pin Hugo extended v0.149.0 into a writable dir
            - export HUGO_VERSION=${HUGO_VERSION:-0.149.0}
            - curl -sSL -o /tmp/hugo.tar.gz "https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz"
            - mkdir -p "$HOME/bin"
            - tar -xzf /tmp/hugo.tar.gz -C "$HOME/bin" hugo
            - chmod +x "$HOME/bin/hugo"
            - export PATH="$HOME/bin:$PATH"
            - hugo version
            # If your theme needs PostCSS:
            - if [ -f package-lock.json ]; then npm ci; fi
        build:
          commands:
            - echo "Building Hugo site..."
            - hugo --minify
      artifacts:
        baseDirectory: public
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - resources/_gen/**/*
          - _vendor/**/*
